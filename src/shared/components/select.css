@import '~/shared/styles/common.css';

@layer components {
	.c-select__button {
		@mixin t-input-style;

		cursor: pointer;
	}

	.c-select__input_description {
		@mixin t-input-base-style;
		@mixin t-input-sibling-states;

		pointer-events: none;
	}

	.c-select__button,
	.c-select__input_description {
		text-align: left;
		width: 100%;
	}

	.c-select__button,
	.c-select__input,
	.c-select__input_description {
		/* To avoid overlap with the chevron or clear */
		padding-right: var(--v-input-height);

		.c-select__container:has(:popover-open) & {
			@mixin t-focus-ring;
		}
	}

	/* Select container parts */
	.c-select__container {
		position: relative;
	}

	.c-select__chevron,
	.c-select__clear {
		position: absolute;
		inset-block: 0;
		right: 0;
		width: var(--v-input-height);
		display: flex;
		align-items: center;
		justify-content: center;
		border: 0;
		background-color: transparent;
		padding: 0;

		@mixin t-text-muted;
	}

	.c-select__chevron {
		display: flex;
	}

	.c-select__clear {
		display: none;

		&:focus {
			@mixin t-radius-inner;
			@mixin t-focus-ring;
		}
	}

	/* Show clear button only is there's something to clear (and not required) */
	.c-select__container:has([role='listbox'] [aria-selected='true']):not(
			:has([aria-required]:not([aria-required='false'])),
			:has(:required)
		)
		.c-select__clear {
		cursor: pointer;
		display: flex;
	}

	/* Hide chevron if clear button is shown */
	.c-select__container:has([role='listbox'] [aria-selected='true']):not(
			:has([aria-required]:not([aria-required='false'])),
			:has(:required)
		)
		.c-select__chevron {
		display: none;
	}

	.c-select__placeholder {
		@mixin t-text-muted;

		*:not(:empty) + & {
			display: none;
		}
	}

	.c-select__items[aria-busy='true'] {
		display: none;
	}

	/* Select dropdown status / empty state */
	.c-select__status {
		@mixin v-text-sm;
		@mixin t-text-muted;
		@mixin t-overflow-x;

		display: none;
		width: 100%;
		overflow: hidden auto;
		padding: calc(var(--v-spacing) - var(--v-inner-radius)) var(--v-spacing);
		text-align: center;

		[aria-busy='true'] + &,
		.c-select__items:empty + & {
			display: block;
		}

		.c-select__no_match,
		.c-select__no_value,
		.c-select__busy {
			display: none;
		}

		/* Busy - hide empty state, show spinner */
		[aria-busy='true'] + & {
			.c-select__busy {
				@mixin o-group;

				justify-content: center;
			}
		}

		/* Different empty states depending on whether there's input */
		.c-select__items:empty:not([aria-busy='true']) + & {
			.c-select__no_match:not(:has(.c-select__no_match_value:empty)) {
				display: block;
			}

			.c-select__no_match:has(.c-select__no_match_value:empty) + .c-select__no_value {
				display: block;
			}
		}
	}

	/* Select typeahead */
	.c-select__input {
		position: absolute;
		inset: 0;
		opacity: 0;
	}

	.c-select__container:has(:popover-open) .c-select__input_description {
		opacity: 0;
	}

	/* Mobile-specific fixed positioning for input + dropdown */
	.c-select__container:has(:popover-open) .c-select__input {
		opacity: 1;
		position: fixed;
		inset: var(--v-spacing) var(--v-spacing) auto var(--v-spacing);
		z-index: var(--v-z-above-backdrop);
		width: auto;
	}

	.c-select__input ~ .c-dropdown__content {
		top: calc(var(--v-input-height) + 2 * var(--v-spacing));
		margin-top: 0;
		margin-bottom: 0;
		max-height: calc(100vh - 3 * var(--v-spacing) - var(--v-input-height));
	}

	/* Undo mobile-specific positioning */
	@mixin v-breakpoint-tablet {
		.c-select__container:has(:popover-open) .c-select__input {
			position: absolute;
			inset: 0;
			width: 100%;
		}

		.c-select__input ~ .c-dropdown__content {
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			top: var(--c-dropdown__top);
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			max-height: var(--c-dropdown__computed-max-height);
		}
	}
}
