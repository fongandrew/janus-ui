@import '~/shared/style/common.css';

@layer base {
	/* No scroll when dropdown open */
	body:has(.c-dropdown__content:popover-open) {
		overflow: hidden;
	}

	/* Dropdown backdrop -- use this instead of ::backdrop because this blocks click-through */
	body:has(.c-dropdown__content:popover-open)::after,
	:modal:has(.c-dropdown__content:popover-open)::after {
		content: ' ';
		position: fixed;
		inset: 0;
		z-index: var(--z-backdrop);
		display: block;
		background-color: var(--backdrop);
		backdrop-filter: blur(4px);
	}

	/* Make backdrop transparent on larger screens */
	@media (width >= $breakpoint-tablet) {
		body:has(.c-dropdown__content:popover-open)::after,
		:modal:has(.c-dropdown__content:popover-open)::after {
			background-color: transparent;
			backdrop-filter: none;
		}
	}
}

@layer components {
	.c-dropdown__content {
		position: fixed;
		margin: 0 auto;
		flex-direction: column;
		overflow: hidden;
		border-radius: var(--radius-md);
		border: 0;
		background-color: var(--popover);
		padding: var(--space-xs) 0;
		color: var(--popover-fg);
		z-index: var(--z-above-backdrop);
		min-width: var(--dropdown-width);

		/* Mobile specific styling */
		inset: var(--space-md);
		width: 100%;
		max-height: calc(100vh - 2 * var(--space-md));
		max-width: calc(100vw - 2 * var(--space-md));

		/*
			Border looks weird with highlighting but is necessary to distinguish card from
			identically colored background, so use this "shadow border"
		*/
		@mixin border-inner var(--shadow-lg);
	}

	.c-dropdown__content:popover-open {
		display: flex;
	}

	.c-dropdown__children {
		flex-grow: 1;
		overflow-y: auto;
	}

	.c-dropdown__footer {
		margin-top: var(--space-xs);
		display: flex;
		flex: none;
		justify-content: flex-end;
		border-top-width: var(--border-width-sm);
		border-top-style: solid;
		padding: var(--space-xs) var(--input-x-md) 0;
		vertical-align: middle;
		font-size: var(--font-size-sm);
		line-height: var(--line-height-sm);

		@mixin border-dynamic var(--card);
	}

	/* Dropdown positioning only on larger screens */
	@media (width >= $breakpoint-tablet) {
		.c-dropdown__content {
			inset: unset;
			width: auto;

			/* These are set via `dropdown.tsx` */
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			left: var(--c-dropdown-left);
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			top: var(--c-dropdown-top);
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			max-height: var(--c-dropdown-max-height);
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			max-width: var(--c-dropdown-max-width);
			/* stylelint-disable-next-line csstools/value-no-unknown-custom-properties */
			min-width: var(--c-dropdown-min-width, 180px);
		}

		.c-dropdown__footer {
			display: none;
		}
	}
}
